import{C as T,r as v,D as f,E as V,F,c as G,a as o,t as n,b as c,G as u,H,I as J,o as K,J as P,K as h,L as U,M as j}from"./vendor-BQxcRIuo.js";import{t as q,g as Q,a as X,b as Y}from"./throttle-BQPPUIL-.js";import{_ as Z}from"./index-e_s328n0.js";const tt={class:"overview-container"},et={class:"summary-cards"},at={class:"card electricity-card"},ot={class:"card-value"},st={class:"card-cost"},lt={class:"card water-card"},it={class:"card-value"},rt={class:"card-cost"},nt={class:"card total-cost-card"},ct={class:"card-value"},dt={class:"buildings-table-container"},ut={class:"charts-container"},pt={class:"chart-card"},mt={class:"chart-card"},vt={class:"chart-card"},ht={__name:"index",setup(_t){const z=J(),{proxy:C}=T(),b=v([]),y=v([]),p=v([]),A=f(()=>b.value.reduce((e,t)=>e+t.electricity,0)),L=f(()=>b.value.reduce((e,t)=>e+t.cost,0)),D=f(()=>y.value.reduce((e,t)=>e+t.water,0)),W=f(()=>y.value.reduce((e,t)=>e+t.cost,0)),N=f(()=>L.value+W.value),S=f(()=>p.value.map(e=>{const t=b.value.filter(l=>l.building_id===e.id),s=y.value.filter(l=>l.building_id===e.id),d=t.reduce((l,r)=>l+r.electricity,0),i=t.reduce((l,r)=>l+r.cost,0),a=s.reduce((l,r)=>l+r.water,0),m=s.reduce((l,r)=>l+r.cost,0);return{...e,totalElectricity:d,totalElectricityCost:i,totalWater:a,totalWaterCost:m,totalCost:i+m}})),w=v(null),x=v(null),E=v(null),_=v([]),R=q(()=>{_.value.forEach(e=>{e&&e.resize()})},300),B=async()=>{try{const e=await Q();b.value=e.data||[];const t=await X();y.value=t.data||[];const s=await Y();p.value=s.data||[],$()}catch(e){console.error("获取数据失败:",e)}},k=e=>{z.push(`/detail/${e}`)},$=()=>{I(),M(),O()},I=()=>{if(!w.value)return;const e=C.$echarts.init(w.value);_.value.push(e);const t=["2025-01","2025-02","2025-03","2025-04","2025-05","2025-06"],s=p.value.map(a=>a.name),d=p.value.map(a=>{const m=t.map(l=>{const r=b.value.find(g=>g.building_id===a.id&&g.month===l);return r?r.electricity:0});return{name:a.name,type:"bar",data:m}}),i={title:{text:"各教学楼月度用电量对比(kWh)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:s,top:"bottom"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:t.map(a=>a.substring(5)),axisLabel:{rotate:30}},yAxis:{type:"value",name:"用电量(kWh)"},series:d};e.setOption(i)},M=()=>{if(!x.value)return;const e=C.$echarts.init(x.value);_.value.push(e);const t=["2025-01","2025-02","2025-03","2025-04","2025-05","2025-06"],s=p.value.map(a=>a.name),d=p.value.map(a=>{const m=t.map(l=>{const r=y.value.find(g=>g.building_id===a.id&&g.month===l);return r?r.water:0});return{name:a.name,type:"line",data:m,smooth:!0}}),i={title:{text:"各教学楼月度用水量对比(吨)",left:"center"},tooltip:{trigger:"axis"},legend:{data:s,top:"bottom"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:t.map(a=>a.substring(5)),axisLabel:{rotate:30}},yAxis:{type:"value",name:"用水量(吨)"},series:d};e.setOption(i)},O=()=>{if(!E.value)return;const e=C.$echarts.init(E.value);_.value.push(e);const t=p.value.map(i=>i.name),s=S.value.map(i=>i.totalCost),d={title:{text:"各教学楼能耗费用占比",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 元 ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:t},series:[{name:"能耗费用",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:t.map((i,a)=>({value:s[a],name:i}))}]};e.setOption(d)};return V(()=>{window.addEventListener("resize",R),B()}),F(()=>{window.removeEventListener("resize",R),_.value.forEach(e=>{e&&e.dispose()}),_.value=[]}),(e,t)=>{const s=P,d=U,i=H;return K(),G("div",tt,[t[6]||(t[6]=o("h2",{class:"page-title"},"2025上半年校园能耗总览",-1)),o("div",et,[o("div",at,[t[1]||(t[1]=o("h3",null,"总用电量",-1)),o("div",ot,n(A.value.toLocaleString())+" kWh",1),o("div",st,"总费用: "+n(L.value.toLocaleString())+" 元",1)]),o("div",lt,[t[2]||(t[2]=o("h3",null,"总用水量",-1)),o("div",it,n(D.value.toLocaleString())+" 吨",1),o("div",rt,"总费用: "+n(W.value.toLocaleString())+" 元",1)]),o("div",nt,[t[3]||(t[3]=o("h3",null,"总耗费金额",-1)),o("div",ct,n(N.value.toLocaleString())+" 元",1)])]),o("div",dt,[t[5]||(t[5]=o("h3",{class:"section-title"},"各教学楼能耗情况",-1)),c(i,{data:S.value,style:{width:"100%"},onRowClick:t[0]||(t[0]=a=>k(a.id)),class:"buildings-table"},{default:u(()=>[c(s,{prop:"name",label:"教学楼"}),c(s,{prop:"type",label:"类型"}),c(s,{prop:"area",label:"面积 (m²)"},{default:u(a=>[h(n(a.row.area.toLocaleString()),1)]),_:1}),c(s,{prop:"totalElectricity",label:"用电量 (kWh)"},{default:u(a=>[h(n(a.row.totalElectricity.toLocaleString()),1)]),_:1}),c(s,{prop:"totalElectricityCost",label:"电费 (元)"},{default:u(a=>[h(n(a.row.totalElectricityCost.toLocaleString()),1)]),_:1}),c(s,{prop:"totalWater",label:"用水量 (吨)"},{default:u(a=>[h(n(a.row.totalWater.toLocaleString()),1)]),_:1}),c(s,{prop:"totalWaterCost",label:"水费 (元)"},{default:u(a=>[h(n(a.row.totalWaterCost.toLocaleString()),1)]),_:1}),c(s,{prop:"totalCost",label:"总费用 (元)"},{default:u(a=>[h(n(a.row.totalCost.toLocaleString()),1)]),_:1}),c(s,{label:"操作",width:"120"},{default:u(a=>[c(d,{type:"primary",size:"small",onClick:j(m=>k(a.row.id),["stop"]),class:"detail-btn"},{default:u(()=>t[4]||(t[4]=[h(" 查看详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),o("div",ut,[o("div",pt,[o("div",{ref_key:"monthlyConsumptionChartRef",ref:E,class:"chart"},null,512)]),o("div",mt,[o("div",{ref_key:"electricityChartRef",ref:w,class:"chart"},null,512)]),o("div",vt,[o("div",{ref_key:"waterChartRef",ref:x,class:"chart"},null,512)])])])}}},gt=Z(ht,[["__scopeId","data-v-d12423e7"]]);export{gt as default};
