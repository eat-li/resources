import{C as D,r as i,E as $,N as S,F as M,c as r,a as t,t as o,O as A,P as E,Q as P,I as H,o as c}from"./vendor-BQxcRIuo.js";import{t as Q,c as T,d as U,e as j}from"./throttle-BQPPUIL-.js";import{_ as q}from"./index-DyMliDMe.js";const G={class:"detail-container"},J={class:"header-section"},K={key:0,class:"page-title"},X={key:1,class:"page-title"},Y={key:0,class:"loading"},Z={key:1,class:"error"},tt={key:2,class:"content"},et={class:"building-info-card"},at={class:"info-item"},st={class:"value"},lt={class:"info-item"},ot={class:"value"},nt={class:"info-item"},it={class:"value"},rt={class:"info-item"},ct={class:"value"},ut={class:"charts-container"},dt={class:"chart-row"},ht={class:"chart-card"},vt={class:"chart-card"},pt={class:"chart-row"},yt={class:"chart-card"},mt={class:"chart-card"},gt={class:"tables-container"},ft={class:"data-table"},_t={class:"data-table"},bt={__name:"index",setup(xt){const F=P(),I=H(),{proxy:g}=D(),f=i(null),v=i(null),u=i([]),d=i([]),w=i(!0),_=i(null),b=i(null),x=i(null),C=i(null),k=i(null),R=()=>{I.push("/")},m=i([]),L=Q(()=>{m.value.forEach(l=>{l&&l.resize()})},300),W=async()=>{try{f.value=F.params.buildingId;const l=await T(f.value),a=await U(f.value);u.value=l.data,d.value=a.data,w.value=!1,_.value=null;const s=await j(f.value);v.value=s.data}catch(l){console.error(l),l.value="获取数据失败，请稍后再试。"}},V=()=>{S(()=>{N(),B(),O(),z()})},N=()=>{if(!b.value)return;const l=g.$echarts.init(b.value);m.value.push(l);const a=u.value.map(e=>e.month.substring(5)),s=u.value.map(e=>e.electricity),h=u.value.map(e=>e.peak_hours_usage),p={title:{text:"月度用电量趋势(kWh)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["总用电量","高峰时段用电量"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:30}},yAxis:{type:"value",name:"用电量(kWh)"},series:[{name:"总用电量",type:"bar",data:s,itemStyle:{color:"#409EFF"}},{name:"高峰时段用电量",type:"bar",data:h,itemStyle:{color:"#E6A23C"}}]};l.setOption(p)},B=()=>{if(!x.value)return;const l=g.$echarts.init(x.value);m.value.push(l);const a=d.value.map(e=>e.month.substring(5)),s=d.value.map(e=>e.water),h=d.value.map(e=>e.daily_avg),p={title:{text:"月度用水量趋势(吨)",left:"center"},tooltip:{trigger:"axis"},legend:{data:["总用水量","日均用水量"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:30}},yAxis:[{type:"value",name:"总用水量(吨)",position:"left"},{type:"value",name:"日均用水量(吨)",position:"right"}],series:[{name:"总用水量",type:"bar",data:s,itemStyle:{color:"#67C23A"}},{name:"日均用水量",type:"line",yAxisIndex:1,data:h,smooth:!0,itemStyle:{color:"#F56C6C"}}]};l.setOption(p)},O=()=>{if(!C.value)return;const l=g.$echarts.init(C.value);m.value.push(l);const a=u.value.map(e=>e.month.substring(5)),s=u.value.map(e=>e.cost),h=u.value.map(e=>(e.cost/e.electricity).toFixed(2)),p={title:{text:"月度电费支出(元)",left:"center"},tooltip:{trigger:"axis",formatter:function(e){let y=e[0].name+"<br/>";return e.forEach(n=>{n.seriesName==="电费"?y+=n.seriesName+": "+n.value.toLocaleString()+" 元<br/>":y+=n.seriesName+": "+n.value+" 元/kWh<br/>"}),y}},legend:{data:["电费","单位电费"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:30}},yAxis:[{type:"value",name:"电费(元)",position:"left"},{type:"value",name:"单位电费(元/kWh)",position:"right",min:0,max:Math.max(...h)*1.2}],series:[{name:"电费",type:"bar",data:s,itemStyle:{color:"#409EFF"}},{name:"单位电费",type:"line",yAxisIndex:1,data:h,smooth:!0,itemStyle:{color:"#F56C6C"}}]};l.setOption(p)},z=()=>{if(!k.value)return;const l=g.$echarts.init(k.value),a=d.value.map(e=>e.month.substring(5)),s=d.value.map(e=>e.cost),h=d.value.map(e=>(e.cost/e.water).toFixed(2)),p={title:{text:"月度水费支出(元)",left:"center"},tooltip:{trigger:"axis",formatter:function(e){let y=e[0].name+"<br/>";return e.forEach(n=>{n.seriesName==="水费"?y+=n.seriesName+": "+n.value.toLocaleString()+" 元<br/>":y+=n.seriesName+": "+n.value+" 元/吨<br/>"}),y}},legend:{data:["水费","单位水费"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:30}},yAxis:[{type:"value",name:"水费(元)",position:"left"},{type:"value",name:"单位水费(元/吨)",position:"right",min:0,max:Math.max(...h)*1.2}],series:[{name:"水费",type:"bar",data:s,itemStyle:{color:"#67C23A"}},{name:"单位水费",type:"line",yAxisIndex:1,data:h,smooth:!0,itemStyle:{color:"#E6A23C"}}]};l.setOption(p)};return $(()=>{window.addEventListener("resize",L),W().then(()=>{(u.value.length>0||d.value.length>0)&&S(()=>{V()})})}),M(()=>{window.removeEventListener("resize",L),m.value.forEach(l=>{l&&l.dispose()}),m.value=[]}),(l,a)=>(c(),r("div",G,[t("div",J,[t("button",{class:"back-btn",onClick:R},"返回首页"),v.value?(c(),r("h2",K,o(v.value.name)+"教学楼("+o(v.value.type)+")能耗详情",1)):(c(),r("h2",X,"教学楼能耗详情"))]),w.value?(c(),r("div",Y," 加载中... ")):_.value?(c(),r("div",Z,o(_.value),1)):(c(),r("div",tt,[t("div",et,[t("div",at,[a[0]||(a[0]=t("span",{class:"label"},"建筑名称:",-1)),t("span",st,o(v.value.name)+"教学楼",1)]),t("div",lt,[a[1]||(a[1]=t("span",{class:"label"},"建筑类型:",-1)),t("span",ot,o(v.value.type),1)]),t("div",nt,[a[2]||(a[2]=t("span",{class:"label"},"建筑面积:",-1)),t("span",it,o(v.value.area.toLocaleString())+" m²",1)]),t("div",rt,[a[3]||(a[3]=t("span",{class:"label"},"楼层数:",-1)),t("span",ct,o(v.value.floors)+" 层",1)])]),t("div",ut,[a[4]||(a[4]=t("h3",{class:"section-title"},"电力消耗分析",-1)),t("div",dt,[t("div",ht,[t("div",{ref_key:"electricityChartRef",ref:b,class:"chart"},null,512)]),t("div",vt,[t("div",{ref_key:"electricityCostChartRef",ref:C,class:"chart"},null,512)])]),a[5]||(a[5]=t("h3",{class:"section-title"},"水资源消耗分析",-1)),t("div",pt,[t("div",yt,[t("div",{ref_key:"waterChartRef",ref:x,class:"chart"},null,512)]),t("div",mt,[t("div",{ref_key:"waterCostChartRef",ref:k,class:"chart"},null,512)])])]),t("div",gt,[a[8]||(a[8]=t("h3",{class:"section-title"},"电力消耗详细数据",-1)),t("table",ft,[a[6]||(a[6]=t("thead",null,[t("tr",null,[t("th",null,"月份"),t("th",null,"总用电量(kWh)"),t("th",null,"高峰时段用电量(kWh)"),t("th",null,"电费(元)"),t("th",null,"高峰用电占比")])],-1)),t("tbody",null,[(c(!0),r(A,null,E(u.value,s=>(c(),r("tr",{key:s.id},[t("td",null,o(s.month),1),t("td",null,o(s.electricity.toLocaleString()),1),t("td",null,o(s.peak_hours_usage.toLocaleString()),1),t("td",null,o(s.cost.toLocaleString()),1),t("td",null,o((s.peak_hours_usage/s.electricity*100).toFixed(2))+"%",1)]))),128))])]),a[9]||(a[9]=t("h3",{class:"section-title"},"水资源消耗详细数据",-1)),t("table",_t,[a[7]||(a[7]=t("thead",null,[t("tr",null,[t("th",null,"月份"),t("th",null,"总用水量(吨)"),t("th",null,"日均用水量(吨)"),t("th",null,"水费(元)"),t("th",null,"单位成本(元/吨)")])],-1)),t("tbody",null,[(c(!0),r(A,null,E(d.value,s=>(c(),r("tr",{key:s.id},[t("td",null,o(s.month),1),t("td",null,o(s.water.toLocaleString()),1),t("td",null,o(s.daily_avg.toLocaleString()),1),t("td",null,o(s.cost.toLocaleString()),1),t("td",null,o((s.cost/s.water).toFixed(2)),1)]))),128))])])])]))]))}},Lt=q(bt,[["__scopeId","data-v-0d03cdde"]]);export{Lt as default};
